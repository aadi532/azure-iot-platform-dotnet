{{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {{
    }},
    "variables": {{}},
    "resources": [
        {{
            "type": "Microsoft.EventGrid/systemTopics/eventSubscriptions",
            "apiVersion": "2021-12-01",
            "name": "{1}/{0}",
            "properties": {{
                "destination": {{
                    "properties": {{
                        "resourceId": "/subscriptions/{2}/resourceGroups/{3}/providers/Microsoft.EventHub/namespaces/{4}/eventhubs/{5}"
                    }},
                    "endpointType": "EventHub"
                }},
                "filter": {{
                    "subjectBeginsWith": "/blobServices/default/containers/{6}-iot-file-upload",
                    "subjectEndsWith": ".csv",
                    "includedEventTypes": [
                        "Microsoft.Storage.BlobCreated"
                    ],
                    "enableAdvancedFilteringOnArrays": false,
                    "advancedFilters": [
                        {{
                            "values": [
                                "/log/"
                            ],
                            "operatorType": "StringContains",
                            "key": "subject"
                        }}
                    ]
                }},
                "labels": [],
                "eventDeliverySchema": "EventGridSchema",
                "retryPolicy": {{
                    "maxDeliveryAttempts": 30,
                    "eventTimeToLiveInMinutes": 1440
                }}
            }}
        }}
    ]
}}