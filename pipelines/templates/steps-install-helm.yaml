parameters:
  helmVersion:
  subscriptionName:
  resourceGroupName:
  aksName:
  kubernetesNamespace:

steps:
  - task: HelmInstaller@1
    displayName: Install Helm
    inputs:
      helmVersionToInstall: $(helmVersion)

  - task: HelmDeploy@0
    displayName: Initialize Helm
    inputs:
      connectionType: Azure Resource Manager
      azureSubscriptionEndpoint: $(subscriptionName)
      azureResourceGroup: $(resourceGroupName)
      kubernetesCluster: $(aksName)
      useClusterAdmin: true
      namespace: $(kubernetesNamespace)
      command: init
      arguments: --force-upgrade --service-account tiller --tiller-image=ghcr.io/helm/tiller:v$(helmVersion)
